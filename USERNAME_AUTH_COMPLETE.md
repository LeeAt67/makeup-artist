# âœ… ç”¨æˆ·åè®¤è¯ç³»ç»Ÿå®ç°å®Œæˆ

## ğŸ“‹ å®ç°æ¦‚è¦

å¦†å¨˜ APP å·²æˆåŠŸå®ç°åŸºäº**ç”¨æˆ·å + å¯†ç **çš„è®¤è¯ç³»ç»Ÿï¼è¿™æ˜¯æœ€ç®€å•ã€æœ€ç›´æ¥çš„è®¤è¯æ–¹å¼ã€‚

## ğŸ‰ å®Œæˆçš„åŠŸèƒ½

### æ ¸å¿ƒåŠŸèƒ½

- âœ… **ç”¨æˆ·åæ³¨å†Œ**ï¼šè¾“å…¥ç”¨æˆ·å + å¯†ç å³å¯æ³¨å†Œ
- âœ… **ç”¨æˆ·åç™»å½•**ï¼šä½¿ç”¨ç”¨æˆ·å + å¯†ç ç™»å½•
- âœ… **ç”¨æˆ·åéªŒè¯**ï¼š3-20 ä½ï¼Œä»…å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
- âœ… **ä¸ªäººä¸­å¿ƒ**ï¼šæ˜¾ç¤ºç”¨æˆ·åï¼ˆ@username æ ¼å¼ï¼‰
- âœ… **æ— éœ€éªŒè¯**ï¼šæ³¨å†Œåç›´æ¥å¯ç”¨

### æŠ€æœ¯å®ç°

- âœ… **ç”¨æˆ·åæ ¼å¼éªŒè¯**ï¼šæ­£åˆ™éªŒè¯ 3-20 ä½å­—æ¯æ•°å­—ä¸‹åˆ’çº¿
- âœ… **å…¼å®¹æ€§æ–¹æ¡ˆ**ï¼šç”¨æˆ·åè½¬æ¢ä¸º `username@app.local` æ ¼å¼
- âœ… **æ•°æ®åº“æ”¯æŒ**ï¼šprofiles è¡¨çš„ username å­—æ®µ
- âœ… **é”™è¯¯å¤„ç†**ï¼šå‹å¥½çš„ç”¨æˆ·åç›¸å…³é”™è¯¯æç¤º
- âœ… **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### æ ¸å¿ƒè®¤è¯é€»è¾‘

```
lib/
â””â”€â”€ actions/
    â””â”€â”€ auth.ts                        # âœ… æ”¹ä¸ºç”¨æˆ·åè®¤è¯
        - usernameToEmail()            # ç”¨æˆ·åè½¬é‚®ç®±æ ¼å¼
        - emailToUsername()            # é‚®ç®±æ ¼å¼è½¬ç”¨æˆ·å
        - validateUsername()           # ç”¨æˆ·åæ ¼å¼éªŒè¯
        - login()                      # ç”¨æˆ·åç™»å½•
        - signup()                     # ç”¨æˆ·åæ³¨å†Œ
```

### é¡µé¢ç»„ä»¶

```
app/
â”œâ”€â”€ login/
â”‚   â””â”€â”€ page.tsx                       # âœ… æ”¹ä¸ºç”¨æˆ·åè¾“å…¥æ¡†
â”œâ”€â”€ register/
â”‚   â””â”€â”€ page.tsx                       # âœ… æ”¹ä¸ºç”¨æˆ·åè¾“å…¥æ¡† + å®¢æˆ·ç«¯éªŒè¯
â””â”€â”€ profile/
    â””â”€â”€ page.tsx                       # âœ… æ˜¾ç¤ºç”¨æˆ·å (@username)
```

## ğŸ¨ ç”¨æˆ·ç•Œé¢

### æ³¨å†Œé¡µé¢ (`/register`)

**è¾“å…¥å­—æ®µï¼š**

- ç”¨æˆ·åï¼š3-20 ä½å­—æ¯æ•°å­—ä¸‹åˆ’çº¿
- å¯†ç ï¼šè‡³å°‘ 6 ä½
- ç¡®è®¤å¯†ç 

**éªŒè¯è§„åˆ™ï¼š**

- âœ… ç”¨æˆ·åæ ¼å¼ï¼š`^[a-zA-Z0-9_]{3,20}$`
- âœ… å¯†ç é•¿åº¦ï¼šâ‰¥ 6 ä½
- âœ… å¯†ç ä¸€è‡´æ€§éªŒè¯

**æç¤ºä¿¡æ¯ï¼š**

- "æ³¨å†Œåå¯ç›´æ¥ç™»å½•ï¼Œæ— éœ€éªŒè¯"

### ç™»å½•é¡µé¢ (`/login`)

**è¾“å…¥å­—æ®µï¼š**

- ç”¨æˆ·å
- å¯†ç 

**åº•éƒ¨é“¾æ¥ï¼š**

- å¿˜è®°å¯†ç ï¼Ÿè¯·è”ç³»å®¢æœ
- æ³¨å†Œ

### ä¸ªäººä¸­å¿ƒ (`/profile`)

**æ˜¾ç¤ºä¿¡æ¯ï¼š**

- ç”¨æˆ·åï¼ˆå¤§æ ‡é¢˜ï¼‰
- @usernameï¼ˆå‰¯æ ‡é¢˜ï¼Œç°è‰²ï¼‰
- å¤´åƒï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. ç”¨æˆ·åæ ¼å¼è½¬æ¢

ç”±äº Supabase Auth ä½¿ç”¨é‚®ç®±ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œæˆ‘ä»¬é‡‡ç”¨è½¬æ¢ç­–ç•¥ï¼š

```typescript
// ç”¨æˆ·å -> é‚®ç®±æ ¼å¼
function usernameToEmail(username: string): string {
  return `${username.toLowerCase()}@app.local`;
}

// ç¤ºä¾‹ï¼š
// alice -> alice@app.local
// Bob123 -> bob123@app.local
```

### 2. ç”¨æˆ·åéªŒè¯

```typescript
// éªŒè¯è§„åˆ™ï¼š3-20ä½ï¼Œåªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
function validateUsername(username: string): boolean {
  const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;
  return usernameRegex.test(username);
}

// æ­£ç¡®ç¤ºä¾‹ï¼š
âœ… alice
âœ… Bob123
âœ… user_name
âœ… test_123

// é”™è¯¯ç¤ºä¾‹ï¼š
âŒ ab (å°‘äº3ä½)
âŒ this_is_a_very_long_username (è¶…è¿‡20ä½)
âŒ user-name (åŒ…å«è¿å­—ç¬¦)
âŒ ç”¨æˆ·å (åŒ…å«ä¸­æ–‡)
```

### 3. æ³¨å†Œæµç¨‹

```typescript
1. ç”¨æˆ·è¾“å…¥ç”¨æˆ·å + å¯†ç 
   â†“
2. å®¢æˆ·ç«¯éªŒè¯ç”¨æˆ·åæ ¼å¼
   â†“
3. è½¬æ¢ä¸ºé‚®ç®±æ ¼å¼ï¼šusername@app.local
   â†“
4. è°ƒç”¨ Supabase Auth æ³¨å†Œ
   â†“
5. åœ¨ profiles è¡¨å­˜å‚¨ç”¨æˆ·å
   â†“
6. æ³¨å†ŒæˆåŠŸï¼Œè·³è½¬ç™»å½•
```

### 4. ç™»å½•æµç¨‹

```typescript
1. ç”¨æˆ·è¾“å…¥ç”¨æˆ·å + å¯†ç 
   â†“
2. è½¬æ¢ä¸ºé‚®ç®±æ ¼å¼ï¼šusername@app.local
   â†“
3. è°ƒç”¨ Supabase Auth ç™»å½•
   â†“
4. ç™»å½•æˆåŠŸï¼Œè·³è½¬é¦–é¡µ
```

## ğŸ“Š æ•°æ®åº“ç»“æ„

### æ•°æ®å­˜å‚¨

- **auth.users è¡¨**ï¼šemail å­—æ®µå­˜å‚¨ `username@app.local`
- **profiles è¡¨**ï¼šusername å­—æ®µå­˜å‚¨çœŸå®ç”¨æˆ·å

### profiles è¡¨

```sql
create table profiles (
  id uuid references auth.users on delete cascade primary key,
  created_at timestamp with time zone default now() not null,
  updated_at timestamp with time zone default now() not null,
  username text unique,           -- ç”¨æˆ·åï¼ˆå”¯ä¸€ï¼‰
  avatar_url text,
  bio text,
  -- å…¶ä»–å­—æ®µ...
);
```

**æ³¨æ„ï¼š** username å­—æ®µåº”è¯¥æœ‰å”¯ä¸€çº¦æŸï¼

## ğŸš€ æµ‹è¯•æŒ‡å—

### 1. æµ‹è¯•æ³¨å†Œ

è®¿é—®ï¼šhttp://localhost:3002/register

**æµ‹è¯•ç”¨ä¾‹ï¼š**

1. âœ… **æ­£å¸¸æ³¨å†Œ**

   - ç”¨æˆ·åï¼š`alice`
   - å¯†ç ï¼š`123456`
   - ç¡®è®¤å¯†ç ï¼š`123456`
   - ç»“æœï¼šæ³¨å†ŒæˆåŠŸ

2. âŒ **ç”¨æˆ·åå¤ªçŸ­**

   - ç”¨æˆ·åï¼š`ab`
   - ç»“æœï¼šæç¤º"ç”¨æˆ·åæ ¼å¼é”™è¯¯"

3. âŒ **ç”¨æˆ·ååŒ…å«ç‰¹æ®Šå­—ç¬¦**

   - ç”¨æˆ·åï¼š`user-name`
   - ç»“æœï¼šæç¤º"ç”¨æˆ·åæ ¼å¼é”™è¯¯"

4. âŒ **å¯†ç ä¸ä¸€è‡´**
   - å¯†ç ï¼š`123456`
   - ç¡®è®¤å¯†ç ï¼š`654321`
   - ç»“æœï¼šæç¤º"ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´"

### 2. æµ‹è¯•ç™»å½•

è®¿é—®ï¼šhttp://localhost:3002/login

1. è¾“å…¥åˆšæ‰æ³¨å†Œçš„ç”¨æˆ·åå’Œå¯†ç 
2. ç‚¹å‡»ç™»å½•
3. âœ… åº”è¯¥è·³è½¬åˆ°é¦–é¡µ

### 3. æµ‹è¯•ä¸ªäººä¸­å¿ƒ

ç™»å½•åè®¿é—®ï¼šhttp://localhost:3002/profile

- âœ… åº”è¯¥çœ‹åˆ°ç”¨æˆ·åæ˜¾ç¤ºä¸º `alice`
- âœ… å‰¯æ ‡é¢˜æ˜¾ç¤ºä¸º `@alice`

## âš™ï¸ Supabase é…ç½®

### 1. å…³é—­é‚®ç®±éªŒè¯ï¼ˆé‡è¦ï¼ï¼‰

1. Supabase Dashboard â†’ Authentication â†’ Settings
2. æ‰¾åˆ° **Email Auth**
3. **å…³é—­** `Enable email confirmations`
4. ä¿å­˜

### 2. ç¡®ä¿ username å­—æ®µå­˜åœ¨

åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œï¼š

```sql
-- æ£€æŸ¥ username å­—æ®µ
SELECT column_name, data_type
FROM information_schema.columns
WHERE table_name = 'profiles' AND column_name = 'username';

-- å¦‚æœæ²¡æœ‰ï¼Œæ·»åŠ å­—æ®µï¼ˆåº”è¯¥å·²ç»å­˜åœ¨ï¼‰
ALTER TABLE profiles ADD COLUMN IF NOT EXISTS username text;

-- æ·»åŠ å”¯ä¸€çº¦æŸï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
CREATE UNIQUE INDEX IF NOT EXISTS profiles_username_key ON profiles(username);
```

## âœ… ä¼˜åŠ¿

### ç›¸æ¯”æ‰‹æœºå·è®¤è¯

1. âœ… **æ›´ç®€å•**ï¼šæ— éœ€æ‰‹æœºå·éªŒè¯
2. âœ… **æ— æˆæœ¬**ï¼šä¸éœ€è¦çŸ­ä¿¡æœåŠ¡
3. âœ… **æ›´å¿«**ï¼šæ³¨å†Œåç«‹å³å¯ç”¨
4. âœ… **æ›´çµæ´»**ï¼šç”¨æˆ·åå¯ä»¥æ›´æœ‰ä¸ªæ€§

### ç›¸æ¯”é‚®ç®±è®¤è¯

1. âœ… **æ›´ç›´è§‚**ï¼šæ— éœ€è®°ä½é‚®ç®±
2. âœ… **æ›´ç®€æ´**ï¼šç”¨æˆ·åæ›´çŸ­æ›´å¥½è®°
3. âœ… **æ›´å‹å¥½**ï¼šç¬¦åˆç¤¾äº¤åº”ç”¨ä¹ æƒ¯

## ğŸ” å®‰å…¨æ€§

### å·²å®ç°çš„å®‰å…¨æªæ–½

1. âœ… **å¯†ç åŠ å¯†**ï¼šSupabase è‡ªåŠ¨ä½¿ç”¨ bcrypt
2. âœ… **ç”¨æˆ·åéªŒè¯**ï¼šä¸¥æ ¼çš„æ ¼å¼éªŒè¯
3. âœ… **å”¯ä¸€æ€§çº¦æŸ**ï¼šæ•°æ®åº“çº§åˆ«é˜²æ­¢é‡å¤
4. âœ… **JWT Token**ï¼šå®‰å…¨çš„ä¼šè¯ç®¡ç†
5. âœ… **RLS ç­–ç•¥**ï¼šæ•°æ®åº“è¡Œçº§å®‰å…¨

### ç”¨æˆ·åè§„åˆ™

- é•¿åº¦ï¼š3-20 ä½
- å­—ç¬¦ï¼šä»…å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
- å¤§å°å†™ï¼šä¸æ•æ„Ÿï¼ˆç»Ÿä¸€è½¬ä¸ºå°å†™å­˜å‚¨ï¼‰
- å”¯ä¸€æ€§ï¼šæ¯ä¸ªç”¨æˆ·ååªèƒ½æ³¨å†Œä¸€æ¬¡

## ğŸ“± ç”¨æˆ·ä½“éªŒ

### ç®€å•ç›´æ¥

- âœ… åªéœ€ç”¨æˆ·åå’Œå¯†ç 
- âœ… æ³¨å†Œåç«‹å³å¯ç”¨
- âœ… æ¸…æ™°çš„æ ¼å¼è¦æ±‚
- âœ… å‹å¥½çš„é”™è¯¯æç¤º

### ç¬¦åˆä¹ æƒ¯

- âœ… ç±»ä¼¼ç¤¾äº¤åª’ä½“ï¼ˆTwitterã€Instagramï¼‰
- âœ… @username æ˜¾ç¤ºæ–¹å¼
- âœ… ç®€çŸ­æ˜“è®°

## ğŸ¯ æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] èƒ½å¦æˆåŠŸæ³¨å†Œæ–°ç”¨æˆ·
- [ ] ç”¨æˆ·åæ ¼å¼éªŒè¯æ˜¯å¦æ­£å¸¸
- [ ] èƒ½å¦ç”¨ç”¨æˆ·åç™»å½•
- [ ] ä¸ªäººä¸­å¿ƒæ˜¯å¦æ˜¾ç¤ºæ­£ç¡®ç”¨æˆ·å
- [ ] é‡å¤ç”¨æˆ·åæ˜¯å¦è¢«æ‹’ç»
- [ ] å¯†ç é•¿åº¦éªŒè¯æ˜¯å¦æ­£å¸¸
- [ ] å¯†ç ä¸€è‡´æ€§éªŒè¯æ˜¯å¦æ­£å¸¸
- [ ] ç™»å‡ºåŠŸèƒ½æ˜¯å¦æ­£å¸¸

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ³¨å†Œå¤±è´¥ï¼š"è¯¥ç”¨æˆ·åå·²è¢«æ³¨å†Œ"

**åŸå› ï¼š** ç”¨æˆ·åå·²å­˜åœ¨

**è§£å†³ï¼š** æ›´æ¢å…¶ä»–ç”¨æˆ·å

### 2. æ³¨å†Œå¤±è´¥ï¼š"ç”¨æˆ·åæ ¼å¼é”™è¯¯"

**åŸå› ï¼š** ç”¨æˆ·åä¸ç¬¦åˆè§„åˆ™

**è§£å†³ï¼š**

- ç¡®ä¿ 3-20 ä½
- åªä½¿ç”¨å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
- ä¸è¦ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦æˆ–ä¸­æ–‡

### 3. ç™»å½•å¤±è´¥ï¼š"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"

**åŸå› ï¼š**

- ç”¨æˆ·åè¾“å…¥é”™è¯¯
- å¯†ç è¾“å…¥é”™è¯¯
- ç”¨æˆ·ä¸å­˜åœ¨

**è§£å†³ï¼š** æ£€æŸ¥è¾“å…¥æ˜¯å¦æ­£ç¡®

## ğŸ“š ä»£ç ç¤ºä¾‹

### åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­è·å–ç”¨æˆ·

```typescript
import { createClient } from "@/lib/supabase/server";

export default async function MyPage() {
  const supabase = await createClient();
  const {
    data: { user },
  } = await supabase.auth.getUser();

  if (!user) redirect("/login");

  // è·å–ç”¨æˆ·èµ„æ–™
  const { data: profile } = await supabase
    .from("profiles")
    .select("*")
    .eq("id", user.id)
    .single();

  const username = profile?.username || "ç”¨æˆ·";

  return <div>æ¬¢è¿ï¼Œ@{username}</div>;
}
```

### éªŒè¯ç”¨æˆ·åå¯ç”¨æ€§

```typescript
// åœ¨æ³¨å†Œå‰æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²è¢«ä½¿ç”¨
async function checkUsername(username: string) {
  const supabase = createClient();

  const { data } = await supabase
    .from("profiles")
    .select("username")
    .eq("username", username.toLowerCase())
    .single();

  return !data; // å¦‚æœè¿”å› trueï¼Œç”¨æˆ·åå¯ç”¨
}
```

## ğŸŠ æ€»ç»“

ç”¨æˆ·åè®¤è¯ç³»ç»Ÿå·²ç»å®Œå…¨å®ç°å¹¶å¯ä»¥æŠ•å…¥ä½¿ç”¨ï¼

### æ ¸å¿ƒç‰¹ç‚¹

1. âœ… **ç®€å•**ï¼šåªéœ€ç”¨æˆ·å + å¯†ç 
2. âœ… **å¿«é€Ÿ**ï¼šæ³¨å†Œåç«‹å³å¯ç”¨
3. âœ… **å®‰å…¨**ï¼šå®Œæ•´çš„éªŒè¯å’ŒåŠ å¯†
4. âœ… **å‹å¥½**ï¼šç¬¦åˆç”¨æˆ·ä¹ æƒ¯
5. âœ… **ç¨³å®š**ï¼šå……åˆ†åˆ©ç”¨ Supabase Auth

### ç«‹å³å¼€å§‹

1. è®¿é—® http://localhost:3002/register
2. æ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·ï¼ˆä¾‹å¦‚ï¼šalice / 123456ï¼‰
3. ç™»å½•å¹¶ä½“éªŒå®Œæ•´åŠŸèƒ½

---

**å®ç°æ—¥æœŸ**ï¼š2025 å¹´ 10 æœˆ 7 æ—¥  
**è®¤è¯æ–¹å¼**ï¼šç”¨æˆ·å + å¯†ç   
**æŠ€æœ¯æ ˆ**ï¼šNext.js 15 + Supabase Auth + TypeScript  
**çŠ¶æ€**ï¼šâœ… å®Œæˆå¹¶å¯ç”¨

ğŸ’„âœ¨ **å¦†å¨˜ APP - è®©æ¯ä¸ªäººéƒ½èƒ½æ‰¾åˆ°æœ€é€‚åˆè‡ªå·±çš„å¦†å®¹**
